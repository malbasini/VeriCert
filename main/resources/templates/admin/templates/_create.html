<div th:fragment="content(pageTitle, active)">
<div class="container mt-5">
    <hr>
    <div id="result" class="mt-3"></div>
    <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-sm6">Nome</span>
        <input type="text" id="name" class="form-control" name="name" placeholder="Nome template" aria-label="Small" aria-describedby="inputGroup-sizing-sm6">
        <span class="input-group-text" id="inputGroup-sizing-sm1">Versione</span>
        <input type="text" id="version" class="form-control" placeholder="Versione" name="version" aria-label="Small" aria-describedby="inputGroup-sizing-sm1">
    </div>
    <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-sm4">Html</span>
        <textarea id="html" class="form-control" name="html" aria-label="Small" rows="10" cols="18" aria-describedby="inputGroup-sizing-sm4"></textarea>
    </div>
    <div class="input-group mb-3">
        <span class="input-group-text" id="inputGroup-sizing-sm5">Variabili JSON</span>
        <textarea id="variablesUserJson" class="form-control" name="variablesJson" aria-label="Small" rows="10" cols="18" aria-describedby="inputGroup-sizing-sm4"></textarea>
    </div>
    <div class="input-group mb-3">
        <div class="form-check">
            <label class="form-check-label" for="active">
                Active
            </label>
            <input class="form-check-input sm-4" type="checkbox" id="active" name="active">
        </div>
    </div>
    <div class="input-group mb-3">
        <button class="btn btn-outline-primary" onclick="createTemplate()">Salva</button>
    </div>
</div>
<script>
    async function createTemplate() {
        try {
            const API_BASE = "http://localhost:8080/api/admin/templates";
            const name = document.getElementById("name").value.trim();
            const version = document.getElementById("version").value.trim();
            const html = document.getElementById("html").value.trim();
            const variablesUserJson = document.getElementById("variablesUserJson").value.trim();
            const active = document.getElementById("active").checked;
            const response = await fetch(`${API_BASE}/new`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: name,
                    version: version,
                    html: html,
                    variablesUserJson: variablesUserJson,
                    active: active
                })
            });
            const resultDiv = document.getElementById("result");
            const data = await response.json();
            if (!response.ok) {
                // Esempio: mostra il primo errore per campo
                const errors = data.errors || {};
                alert(Object.entries(errors).map(([field, msgs]) => `${field}: ${msgs[0]}`).join("\n"));
                return;
            } else {
                resultDiv.innerHTML = `
                <div class="alert alert-success">
                    âœ… <b>Template creato con successo</b><br>
                    <b>ID:</b> ${data.id}<br>
                    <b>Nome:</b> ${data.name}<br>
                    <b>Versione:</b> ${data.version}<br>
                    <b>Attivo:</b> ${data.active}<br>
                    <b>Nome tenant:</b> ${data.tenant}<br>
                </div>
            `;
            }
        }
        catch (error) {
            console.error("Errore durante la creazione del template:", error);
            showToast("Errore durante la creazione del template " + error.message);
        }
    }
</script>
<script>
    function showToast(message) {
        const toastEl = document.getElementById('appToast');
        toastEl.querySelector('.toast-body').textContent = message;
        const t = bootstrap.Toast.getOrCreateInstance(toastEl);
        t.show();
    }
</script>
</div>