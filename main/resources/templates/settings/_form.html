<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<div th:fragment="content(form,usage,pageTitle, active)">
<body class="bg-light">

<div class="container my-4">
    <!-- Alert di salvataggio -->
    <div th:if="${saved}" class="alert alert-success alert-dismissible fade show" role="alert">
        Impostazioni salvate con successo.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <h1 class="h3 mb-3">
        Impostazioni organizzazione
        <small class="text-muted d-block" th:text="${#authentication.principal.tenantName}">TenantName</small>
    </h1>
    <form method="post" th:object="${form}">
        <ul class="nav nav-tabs mb-3" id="settingsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-profile"
                        type="button" role="tab">Profilo</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-branding"
                        type="button" role="tab">Branding certificati</button>
            </li>
            <li class="nav-item ms-auto" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-usage"
                        type="button" role="tab">
                    Utilizzo & limiti
                </button>
            </li>
        </ul>
        <div class="tab-content border rounded p-3 bg-white">
            <!-- PROFILO -->
            <div class="tab-pane fade show active" id="tab-profile" role="tabpanel">
                <div class="mb-3">
                    <label class="form-label">Ragione sociale / Nome pubblico</label>
                    <input class="form-control" th:field="*{displayName}">
                    <div class="text-danger small" th:if="${#fields.hasErrors('displayName')}"
                         th:errors="*{displayName}">Err
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Email di contatto</label>
                    <input class="form-control" th:field="*{contactEmail}">
                    <div class="text-danger small" th:if="${#fields.hasErrors('contactEmail')}"
                         th:errors="*{contactEmail}">Err
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Sito web</label>
                    <input class="form-control" th:field="*{website}">
                </div>
            </div>
            <!-- BRANDING -->
            <div class="tab-pane fade" id="tab-branding" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">

                        <div class="mb-3">
                            <label class="form-label">Nome firmatario</label>
                            <input class="form-control" th:field="*{issuerName}">
                            <div class="text-danger small" th:if="${#fields.hasErrors('issuerName')}"
                                 th:errors="*{issuerName}">Err
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Ruolo firmatario</label>
                            <input class="form-control" th:field="*{issuerRole}">
                            <div class="text-danger small" th:if="${#fields.hasErrors('issuerRole')}"
                                 th:errors="*{issuerRole}">Err
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Colore primario (brand)</label>
                            <input class="form-control" th:field="*{primaryColor}" placeholder="#0d6efd">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Template di default</label>
                            <input class="form-control" th:field="*{defaultTemplateId}"
                                   placeholder="ID template attivo">
                            <div class="form-text">
                                Usato in fase di emissione certificato.
                            </div>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Logo URL</label>
                            <input class="form-control" th:field="*{logoUrl}">
                            <div class="form-text">Mostrato nel PDF in alto a sinistra.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Firma digitale URL</label>
                            <input class="form-control" th:field="*{signatureImageUrl}">
                            <div class="form-text">PNG trasparente della firma, se disponibile.</div>
                        </div>
                        <!-- mini anteprima -->
                        <div class="border rounded p-3 bg-light">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <img th:src="*{logoUrl}" alt="logo preview" style="max-height:60px;">
                                </div>
                                <div>
                                    <div class="fw-semibold" th:text="*{issuerName}">Mario Rossi</div>
                                    <div class="text-muted small" th:text="*{issuerRole}">Direttore Formazione</div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <img th:src="*{signatureImageUrl}" alt="signature preview" style="max-height:60px;">
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- USAGE -->
            <div class="tab-pane fade" id="tab-usage" role="tabpanel">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="card border-success">
                            <div class="card-body">
                                <div class="text-muted small">Certificati emessi questo mese</div>
                                <div class="fs-4 fw-semibold"
                                     th:text="${usage.issuedThisMonth} + ' / ' + ${usage.monthlyLimit}">
                                    12 / 20
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-primary">
                            <div class="card-body">
                                <div class="text-muted small">Storage usato</div>
                                <div class="fs-4 fw-semibold"
                                     th:text="${usage.storageUsed} + ' / ' + ${usage.storageLimit}">
                                    5.2 MB / 100 MB
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 d-flex align-items-center">
                        <div class="text-muted small">
                            Questi limiti dipendono dal piano del tenant.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- footer form -->
        <div class="d-flex justify-content-between mt-3">
            <a href="/admin" class="btn btn-outline-secondary">
                ‚Üê Torna alla dashboard
            </a>

            <button type="submit" class="btn btn-primary">
                Salva impostazioni
            </button>
        </div>
    </form>
</div>
</body>
    <script th:if="${saved}" >
        showToast("Impostazioni salvate con successo",{ colorClass: 'bg-success', icon: 'fa-check' });
    </script>
</div>
</html>
